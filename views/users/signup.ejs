<% layout("/layouts/boilerplate") %>

<div class="add-book-container" style="max-width: 500px; margin-top: 50px;">
    <h1 style="text-align: center; color: var(--primary); margin-bottom: 30px;">
        Join MyBooks
    </h1>

    <form action="/signup" method="POST" novalidate class="needs-validation">
        
        <div class="form-group">
            <label for="username">Username</label>
            <input name="username" id="username" type="text" class="form-control" required />
        </div>

        <div class="form-group">
            <label for="email">Email</label>
            <input name="email" id="email" type="email" class="form-control" required />
        </div>

        <div class="form-group">
            <label for="locationInput">Your Location (City/College)</label>
            <input 
                id="locationInput" 
                name="location" 
                type="text" 
                class="form-control" 
                placeholder="Start typing your city..." 
                required 
            />
            <input type="hidden" name="lat" id="lat">
            <input type="hidden" name="lng" id="lng">
        </div>

        <div class="form-group">
            <label for="password">Password</label>
            <input name="password" id="password" type="password" class="form-control" required />
        </div>

        <button class="cta-button" style="width: 100%; margin-top: 10px;">Sign Up</button>
    </form>
</div>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC6yuJCX3uhNpahtmD9vZrjSLnMDoO3zaw&libraries=places"></script>

<script>
    function initAutocomplete() {
        // 1. Get the input element
        const input = document.getElementById("locationInput");
        
        // 2. Turn it into a Google Autocomplete field
        const autocomplete = new google.maps.places.Autocomplete(input);

        // 3. Listen for when the user selects a place
        autocomplete.addListener("place_changed", () => {
            const place = autocomplete.getPlace();
            
            if (!place.geometry) {
                // User entered the name of a Place that was not suggested
                return; 
            }

            // 4. Fill the hidden inputs with coordinates
            document.getElementById("lat").value = place.geometry.location.lat();
            document.getElementById("lng").value = place.geometry.location.lng();
        });
    }

    // Initialize when page loads
    google.maps.event.addDomListener(window, 'load', initAutocomplete);
</script>